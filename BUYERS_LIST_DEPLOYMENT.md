# 📊 Buyers List フェーズ2実装計画

## ✅ 完了した分析

### Excelファイル構造
- **ヘッダー行**: 2-4行目（階層構造）
- **データ行**: 5行目以降
- **総列数**: 約100列以上
- **重要な列**: 30+列を特定済み

---

## 🎯 フェーズ2の目標

**列番号に依存しない、ヘッダー名ベースのインポート機能**

### メリット
✅ 列の順序が変わっても動作  
✅ 新しい列を途中に追加しても問題なし  
✅ ヘッダーマッピングに1行追加するだけで新フィールド対応  
✅ 保守性・拡張性が大幅に向上

---

## 📝 実装済みファイル

### 1. ImportBuyersListExcel_HeaderBased.js
ヘッダー名ベースのインポート機能

**主な機能**:
- ヘッダー行（2-4行目）を自動解析
- 階層的なヘッダーに対応（例：「Eメール > 本人」）
- ヘッダーマッピング定義で簡単にフィールド追加可能

**現在対応しているフィールド（30+個）**:

#### 基本情報
- 日本担当
- ハワイ担当  
- HHC担当
- ユニット番号
- 契約者名（ローマ字）
- 契約者名（日本語）
- Escrow番号
- 住所

#### 連絡先
- 電話
- Eメール（本人）
- Eメール（CC）
- Eメール（DocuSign）
- Eメール（メモ）

#### 物件情報
- Unit Type
- Bed/Bath
- sqft

#### 契約情報
- 契約日
- 購入価格
- 目的
- 個人/法人
- 登記日
- 登記名義

#### 支払いスケジュール
- 1st Deposit金額
- 1st Deposit期日
- 1st Deposit Receipt
- 2nd Deposit金額
- 3rd Deposit金額
- 残金

#### 駐車場・ストレージ
- 駐車場番号
- ストレージ申込み
- ストレージ番号

### 2. buyersListSchema_v2.js
拡張されたデータモデル定義

---

## 🔄 デプロイ手順

### ステップ1: バックエンドの更新

```bash
# Boxから以下のファイルを更新
api/ImportBuyersListExcel.js  ← ImportBuyersListExcel_HeaderBased.js で置き換え
api/buyersListSchema.js         ← buyersListSchema_v2.js で置き換え
```

### ステップ2: 他のAPIの更新

以下のAPIファイルも新しいフィールドに対応させる必要があります：

```
api/CreateBuyersListItem.js
api/UpdateBuyersListItem.js
api/GetBuyersList.js
```

**変更内容**: 新しいフィールドを追加

### ステップ3: フロントエンドの更新

```
app/src/BuyersListView.jsx
```

**変更内容**:
- テーブル列の追加
- フォームフィールドの追加
- 表示フィールドの選択機能（オプション）

### ステップ4: データベースの対応

**重要**: Cosmos DBはスキーマレスなので、構造変更は不要！  
既存データはそのまま、新しいフィールドは新規インポート時に追加されます。

---

## 🎨 フロントエンド設計案

### 案A: 全フィールド表示（シンプル）

すべてのフィールドをテーブルに表示（横スクロール）

**メリット**:
- ✅ 実装が簡単
- ✅ すべての情報が一目で見える

**デメリット**:
- ❌ 画面が横に長い
- ❌ スマホで見づらい

### 案B: タブ表示（推奨）

情報を複数のタブに分割：
1. **基本情報タブ**: 担当者、ユニット、契約者、連絡先
2. **物件情報タブ**: Unit Type, Bed/Bath, sqft, 住所
3. **支払いタブ**: 購入価格、各種Deposit、残金
4. **追加情報タブ**: 駐車場、ストレージ、その他

**メリット**:
- ✅ 画面がすっきり
- ✅ 情報が整理される
- ✅ スマホでも見やすい

### 案C: マスター・詳細ビュー（最も高度）

- **一覧画面**: 最小限の情報のみ表示（担当者、ユニット、契約者、ステータス）
- **詳細画面**: クリックで詳細情報を別画面で表示

**メリット**:
- ✅ 最も見やすい
- ✅ パフォーマンスが良い

**デメリット**:
- ❌ 実装が複雑

---

## 🚀 推奨実装順序

### 第1弾（今週）: バックエンド完成
- [x] ヘッダー名ベースのインポート機能
- [x] 拡張されたデータモデル
- [ ] 他のAPIファイルの更新
- [ ] テスト・デプロイ

### 第2弾（来週）: フロントエンド対応
- [ ] 詳細情報表示の実装（タブ方式推奨）
- [ ] 編集フォームの拡張
- [ ] フィルター・検索機能の強化

### 第3弾（再来週）: 高度な機能
- [ ] Excelエクスポート機能
- [ ] ダッシュボード統合
- [ ] レポート機能

---

## 📋 次のアクション

どの案で進めますか？

**A. すぐにデプロイ（第1弾完了）**
→ バックエンドのみ更新、フロントは後日

**B. フロントエンド設計を先に決定**
→ 案A/B/Cから選択、または独自案を提案

**C. 段階的実装**
→ まずは重要フィールド3-5個だけ追加

**D. その他の要望**
→ 具体的な要件を教えてください

---

**作成日**: 2026-01-22  
**対象**: TPWV Buyers List管理システム  
**フェーズ**: Phase 2 - フィールド拡張
